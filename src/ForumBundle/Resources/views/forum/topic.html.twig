{% extends '@Forum/layout/layout.html.twig' %}

{% block title %}{{ topic.forum.title }} / {{ topic.title }}{% endblock %}

{% block header %}
    {{ parent() }}
    {% if app.user and (is_granted('DELETE', topic) or is_granted('EDIT', topic)) %}
        <a href="#topic{{ topic.id }}" data-rel="popup" data-transition="slideup" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-gear">Управление</a>
        <div data-role="popup" id="topic{{ topic.id }}" data-theme="b">
            <ul data-role="listview" data-inset="true" style="min-width:210px;">
                <li data-role="list-divider">Действие</li>
                {% if is_granted('EDIT', topic) %}
                    <li><a href="{{ path('topic_edit', {'id': topic.id}) }}">Редактировать</a></li>
                {% endif %}
                {% if is_granted('DELETE', topic) %}
                    <li><a href="{{ path('topic_delete', {'id': topic.id}) }}">Удалить</a></li>
                {% endif %}
            </ul>
        </div>
    {% endif %}
{% endblock %}

{% block content %}
    <ul data-role="listview" data-inset="true" data-split-icon="edit" data-split-theme="a">
        {% for post in posts %}
            <li class="ui-li-divider ui-bar-inherit ui-first-child" data-role="list-divider">{{ post.user.username }}: {{ post.createdAt|date }}</li>
            <li>
                <a>
                    <p>{{ post.text }}</p>
                </a>
                {% if app.user and is_granted('EDIT', post) %}
                    {# {{ path('post_edit', {'id': post.id}) }} #}
                    <a href="#post{{ post.id }}" data-rel="popup" data-transition="slideup" class="ui-btn ui-icon-gear ui-btn-icon-left ui-btn-a">Управление</a>
                    <div data-role="popup" id="post{{ post.id }}" data-theme="b">
                        <ul data-role="listview" data-inset="true" style="min-width:210px;">
                            <li data-role="list-divider">Действие</li>
                            <li><a href="{{ path('post_edit', {'id': post.id}) }}">Редактировать</a></li>
                            <li><a href="{{ path('post_delete', {'id': post.id}) }}">Удалить</a></li>
                        </ul>
                    </div>
                {% endif %}
            </li>
        {% else %}
            <li>Пусто</li>
        {% endfor %}
    </ul>
    {% include 'ForumBundle:layout:paginate.html.twig' with {'data': posts} %}

    {{ form_start(form) }}
        {{ form_widget(form) }}
    {{ form_end(form) }}

{% endblock %}