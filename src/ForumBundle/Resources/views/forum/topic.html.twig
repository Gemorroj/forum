{% extends '@Forum/layout/layout.html.twig' %}

{% block title %}{{ topic.forum.title }} / {{ topic.title }}{% endblock %}

{% block content %}
    <ul data-role="listview" data-inset="true" data-split-icon="edit" data-split-theme="a">
        {% for post in posts %}
            <li class="ui-li-divider ui-bar-inherit ui-first-child" data-role="list-divider">{{ post.user.username }}: {{ post.createdAt|date }}</li>
            <li>
                <a>{{ post.text }}</a>
                {% if app.user and is_granted('EDIT', post) %}
                    <a href="{{ path('post_edit', {'id': post.id}) }}">Редактировать</a>
                {% endif %}
            </li>
        {% else %}
            <li>Пусто</li>
        {% endfor %}
    </ul>
    {% include 'ForumBundle:layout:paginate.html.twig' with {'data': posts} %}

    {{ form_start(form) }}
        {{ form_widget(form) }}
    {{ form_end(form) }}

    {% if app.user and (is_granted('DELETE', topic) or is_granted('EDIT', topic)) %}
        <div class="ui-grid-a">
            {% if is_granted('EDIT', topic) %}
                <div class="ui-block-a">
                    <a class="ui-shadow ui-btn ui-corner-all ui-btn-icon-left ui-icon-edit" href="{{ path('topic_edit', {'id': topic.id}) }}">Редактировать</a>
                </div>
            {% endif %}
            {% if is_granted('DELETE', topic) %}
                <div class="ui-block-b">
                    <a class="ui-shadow ui-btn ui-corner-all ui-btn-icon-left ui-icon-delete" href="{{ path('topic_delete', {'id': topic.id}) }}">Удалить</a>
                </div>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}